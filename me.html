<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Tousif Power Billing</title>

<script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>

<style>

body{
font-family:Arial;
background:#eaeaea;
margin:0;
}

/* PANEL */

.container{
max-width:900px;
margin:auto;
padding:15px;
background:white;
margin-top:20px;
border-radius:10px;
box-shadow:0 0 10px gray;
}

input{
width:100%;
padding:8px;
margin:5px 0;
}

button{
padding:8px 15px;
background:#0b7dda;
color:white;
border:none;
border-radius:5px;
cursor:pointer;
margin-top:5px;
}

table{
width:100%;
border-collapse:collapse;
margin-top:10px;
}

table,th,td{
border:1px solid black;
padding:6px;
text-align:center;
}

/* BILL */

.bill{
width:210mm;
padding:15mm;
border:2px solid black;
background:white;
margin:auto;
margin-top:20px;
display:none;
}

.logo{
width:120px;
margin-bottom:10px;
}

.header{
display:flex;
justify-content:space-between;
}

.sign{
display:flex;
justify-content:space-between;
margin-top:100px;
}

@media print{
button{display:none;}
.bill{border:none;}
}

</style>
</head>

<body>

<div class="container">

<h2>‚ö° Tousif Power Billing Panel</h2>

Company Logo Upload
<input type="file" onchange="uploadLogo(event)">

Customer Name
<input id="name">

Customer Phone
<input id="phone">

<table id="itemTable">
<tr>
<th>Item</th>
<th>Qty</th>
<th>Price</th>
<th>Total</th>
</tr>
</table>

<button onclick="addItem()">Add Item</button>

Labour Charge
<input id="labour" type="number" value="0">

GST %
<input id="gst" type="number" value="18">

<button onclick="generateBill()">Generate Bill</button>

<h3>üîç Invoice Search</h3>
<input id="searchBill" placeholder="Enter Bill Number">
<button onclick="searchBill()">Search</button>

</div>

<!-- BILL -->

<div id="bill" class="bill">

<img id="logoImg" class="logo">

<div class="header">
<div>
<h2>M/S Tousif Power Solutions</h2>
Malda, West Bengal <br>
GSTIN : 19ABCDE1234F1Z5
</div>

<div>
Bill No : <span id="billNo"></span><br>
Date : <span id="date"></span>
</div>
</div>

<hr>

Customer : <span id="bName"></span><br>
Phone : <span id="bPhone"></span>

<table id="billTable"></table>

<br>

Subtotal : ‚Çπ <span id="sub"></span><br>
CGST : ‚Çπ <span id="cgst"></span><br>
SGST : ‚Çπ <span id="sgst"></span><br>

<h3>Grand Total : ‚Çπ <span id="grand"></span></h3>

<div class="sign">
<div>Customer Signature</div>
<div>Authorized Signature & Seal</div>
</div>

<button onclick="downloadPDF()">Download PDF</button>
<button onclick="sendWhatsApp()">Send WhatsApp</button>

</div>

<script>

/* LOGO */

function uploadLogo(e){
let file=e.target.files[0]
let reader=new FileReader()

reader.onload=function(){
localStorage.setItem("logo",reader.result)
document.getElementById("logoImg").src=reader.result
}

reader.readAsDataURL(file)
}

window.onload=function(){
let logo=localStorage.getItem("logo")
if(logo) document.getElementById("logoImg").src=logo
}

/* ADD ITEM */

function addItem(){
let row=itemTable.insertRow()
row.innerHTML=`
<td><input></td>
<td><input type="number" value="1"></td>
<td><input type="number" value="0"></td>
<td>0</td>`
}

/* SERIAL */

let billSerial=localStorage.getItem("serial")||1001

function generateBill(){

let billData={}
let table=itemTable
let billTable=document.getElementById("billTable")

billTable.innerHTML="<tr><th>Item</th><th>Qty</th><th>Price</th><th>Total</th></tr>"

let subtotal=0
let items=[]

for(let i=1;i<table.rows.length;i++){

let item=table.rows[i].cells[0].children[0].value
let qty=Number(table.rows[i].cells[1].children[0].value)
let price=Number(table.rows[i].cells[2].children[0].value)

let total=qty*price
subtotal+=total

items.push({item,qty,price,total})

billTable.innerHTML+=`
<tr>
<td>${item}</td>
<td>${qty}</td>
<td>${price}</td>
<td>${total}</td>
</tr>`
}

let labour=Number(labour.value)
subtotal+=labour

let gst=Number(gst.value)
let gstAmt=subtotal*gst/100

let cgst=gstAmt/2
let sgst=gstAmt/2
let grand=subtotal+gstAmt

bill.style.display="block"

billNo.innerText=billSerial
date.innerText=new Date().toLocaleDateString()

bName.innerText=name.value
bPhone.innerText=phone.value

sub.innerText=subtotal.toFixed(2)
cgst.innerText=cgst.toFixed(2)
sgst.innerText=sgst.toFixed(2)
grand.innerText=grand.toFixed(2)

/* SAVE HISTORY */

billData={
billNo:billSerial,
name:name.value,
phone:phone.value,
items,
grand
}

let history=JSON.parse(localStorage.getItem("history")||"[]")
history.push(billData)
localStorage.setItem("history",JSON.stringify(history))

billSerial++
localStorage.setItem("serial",billSerial)

}

/* SEARCH */

function searchBill(){

let no=Number(searchBill.value)
let history=JSON.parse(localStorage.getItem("history")||"[]")

let bill=history.find(b=>b.billNo==no)

if(bill) alert("Found Bill for "+bill.name)
else alert("Bill Not Found")

}

/* PDF */

function downloadPDF(){

html2pdf().from(bill).save("Invoice.pdf")
}

/* WHATSAPP */

function sendWhatsApp(){

let msg=Invoice ${billNo.innerText} Total ‚Çπ${grand.innerText}
let phone=bPhone.innerText

window.open(https://wa.me/91${phone}?text=${encodeURIComponent(msg)})
}

</script>

</body>
</html>
